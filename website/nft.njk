---
layout: layouts/base.njk
pagination:
  data: nfts
  size: 1
  alias: nft
permalink: "collection/nft-{{ nft.name }}.html"
---
<script type="module" async>

  import {ethers} from "/js/ethers.js";
  import {abi} from "/js/identity-contract.js";

  // document.getElementById("mint").addEventListener("click", mint);
  document.getElementById("modalText").innerHTML = "Connecting to MetaMask...";


  async function mint() {
    if (!window.ethereum) {
      alert('Metamask not found, please install it');
      return
    }
    const chainId = await window.ethereum.request({ method: 'eth_chainId' });
    if (chainId != 97) {  // BSC testnet
      await window.ethereum.request({
        method: 'wallet_switchEthereumChain',
        params: [{ chainId: '0x61' }],
      });
    }

    await window.ethereum.send('eth_requestAccounts');
    let provider = new ethers.providers.Web3Provider(window.ethereum, "any");// any needed to allow network changes
    isAddressKnown(provider).then(async resp => {
        console.log("Inside the response: ", resp);
        if (resp == true) {
          document.getElementById("modalText").innerHTML = "Minting the NFT";
          console.log("Continue with the minting procedure");
          // const signer = this.provider.getSigner();
          // const contract = new ethers.Contract("0x1585233e4B961f222653DFe642b81116bBb3AcD1", globalAbi, this.provider);
          // const estimatedGas = await contract.connect(signer).estimateGas['mint']();
          // const result = await contract.connect(signer)['mint']({
          //   gasLimit: estimatedGas,
          //   nonce: undefined,
          // });
          // console.log("Result: ", result);
          // return result.wait();

        }
        else {
          document.getElementById("modalText").innerHTML = "<p> It appears your metamask address is un-known<p>" +
            "<p> you will be redirected to Proofi for your registration </p>" ;
          await delay(2000);
          //redirect to participate with the url of this page as redirectUrl
          window.open(`http://localhost:4200/accounts/participate?redirectUrl=${encodeURIComponent(window.location.href)}`,"_self")
        }
      }
    );
  }

  function delay(milliseconds){
    return new Promise(resolve => {
      setTimeout(resolve, milliseconds);
    });
  }

  async function isAddressKnown(provider) {
    const contractAddress = '0xBA0E036B0Bf7D1C1aF169d4Cf9e49a06A8F3F01a';
    const signer = provider.getSigner();
    const address = await signer.getAddress();
    const contract = new ethers.Contract(contractAddress, abi, provider);
    //return contract.isKnown(address)
    return contract['isKnown'](address).then((resp) => {
      return resp;
    }).
    catch((error) => {
      console.log(error);
      return false;
    })
  }

  var modal = document.getElementById("myModal");

  // Get the button that opens the modal
  var btn = document.getElementById("myBtn");


  // Get the <span> element that closes the modal
  var span = document.getElementsByClassName("close")[0];

  // When the user clicks the button, open the modal
  btn.onclick = function() {
    modal.style.display = "block";
    mint();
  }

  // When the user clicks on <span> (x), close the modal
  span.onclick = function() {
    modal.style.display = "none";
  }

  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }
</script>

<div class="metaportal_fn_mintpage">

  <div class="container small">

    <!-- Mint Top -->
    <div class="metaportal_fn_mint_top">
      <div class="mint_left">
        <div class="img" id="nftImg">
							<div class="img_in"  data-bg-img='https://ipfs.krazykobe.com/ipfs/QmdYSTJEnRyjMtuXpE2PeC9M2jA91UYigcmx49fguxQZUt/{{ nft.name}}.jpg'>
                <div>
                  <img src='https://ipfs.krazykobe.com/ipfs/QmdYSTJEnRyjMtuXpE2PeC9M2jA91UYigcmx49fguxQZUt/{{ nft.name }}.jpg' alt=''>
                </div>
              </div>
        </div>
      </div>
      <div class="mint_right">
        <div class="metaportal_fn_share">
          <h5 class="label">Share:</h5>
          <ul>
            <li><a href="#"><img src="/svg/social/twitter-1.svg" alt="" class="fn__svg"></a></li>
            <li><a href="#"><img src="/svg/social/facebook-1.svg" alt="" class="fn__svg"></a></li>
            <li><a href="#"><img src="/svg/social/instagram-1.svg" alt="" class="fn__svg"></a></li>
            <li><a href="#"><img src="/svg/social/pinterest-1.svg" alt="" class="fn__svg"></a></li>
            <li><a href="#"><img src="/svg/social/behance-1.svg" alt="" class="fn__svg"></a></li>
          </ul>
        </div>
<!--              <h3 class="fn__maintitle" data-text="Krazy Kobe" data-align="left" id="kkTitle">-->
          <h3 class="fn__maintitle" data-align="left">
              Krazy Kobe {{ nft.name }}
          </h3>
        <div class="view_on">
          <ul>
            <li>
              <span>View On:</span>
            </li>
            <li>
              <a href="#"><img src="/svg/opensea.svg" alt="" class="fn__svg"></a>
            </li>

          </ul>
        </div>
        <a  class="metaportal_fn_button" id="myBtn">Mint Now</a>

        <!-- The Modal -->
        <div id="myModal" class="modal">

          <!-- Modal content -->
          <div class="modal-content">
            <span class="close">&times;</span>
            <p id="modalText">Some text in the Modal..</p>
          </div>

        </div>

        <div class="mint_desc">
{#          <a class="metaportal_fn_button" id="mint">#}
{#            <span>Mint Now</span>#}
{#          </a>#}
          <p>By clicking “MINT NOW” button, you agree to our <a href="#">Terms of Service</a> and our <a href="#">Privacy Policy</a>.</p>
        </div>
      </div>

    </div>
    <!-- !Mint Top -->


    <!-- NFT Categories -->
    <div class="metaportal_fn_nft_cats">
      <ul>
        <li>
          <div class="item">
            <h4 class="parent_category" >Image</h4>
            <h3 class="child_category" title="Image" id="nftImage"> {{ nft.property1 }}</h3>
          </div>
        </li>
        <li>
          <div class="item">
            <h4 class="parent_category">Body</h4>
            <h3 class="child_category" title="Body" id="nftBody"> {{ nft.property2 }}</h3>
          </div>
        </li>
        <li>
          <div class="item">
            <h4 class="parent_category">Type</h4>
            <h3 class="child_category" title="Type" id="nftType"> {{ nft.property3 }}</h3>
          </div>
        </li>
      </ul>
    </div>
  </div>


</div>
